
question_content = """
ä½œä¸ºå›½ç‹çš„ç»Ÿæ²»è€…ï¼Œä½ æœ‰ä¸€æ”¯å·«å¸ˆå†›é˜Ÿå¬ä½ æŒ‡æŒ¥ã€‚ 

 ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ strength ï¼Œå…¶ä¸­ strength[i] è¡¨ç¤ºç¬¬ i ä½å·«å¸ˆçš„åŠ›é‡å€¼ã€‚å¯¹äºè¿ç»­çš„ä¸€ç»„å·«å¸ˆï¼ˆä¹Ÿå°±æ˜¯è¿™äº›å·«å¸ˆçš„åŠ›é‡å€¼æ˜¯
 strength çš„ å­æ•°ç»„ï¼‰ï¼Œæ€»åŠ›é‡ å®šä¹‰ä¸ºä»¥ä¸‹ä¸¤ä¸ªå€¼çš„ ä¹˜ç§¯ ï¼š 

 
 å·«å¸ˆä¸­ æœ€å¼± çš„èƒ½åŠ›å€¼ã€‚ 
 ç»„ä¸­æ‰€æœ‰å·«å¸ˆçš„ä¸ªäººåŠ›é‡å€¼ ä¹‹å’Œ ã€‚ 
 

 è¯·ä½ è¿”å› æ‰€æœ‰ å·«å¸ˆç»„çš„ æ€» åŠ›é‡ä¹‹å’Œã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å°†ç­”æ¡ˆå¯¹ 10â¹ + 7 å–ä½™ åè¿”å›ã€‚ 

 å­æ•°ç»„ æ˜¯ä¸€ä¸ªæ•°ç»„é‡Œ éç©º è¿ç»­å­åºåˆ—ã€‚ 

 

 ç¤ºä¾‹ 1ï¼š 

 è¾“å…¥ï¼šstrength = [1,3,1,2]
è¾“å‡ºï¼š44
è§£é‡Šï¼šä»¥ä¸‹æ˜¯æ‰€æœ‰è¿ç»­å·«å¸ˆç»„ï¼š
- [1,3,1,2] ä¸­ [1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1]) * sum([1]) = 1 * 1 = 1
- [1,3,1,2] ä¸­ [3] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([3]) * sum([3]) = 3 * 3 = 9
- [1,3,1,2] ä¸­ [1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1]) * sum([1]) = 1 * 1 = 1
- [1,3,1,2] ä¸­ [2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([2]) * sum([2]) = 2 * 2 = 4
- [1,3,1,2] ä¸­ [1,3] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,3]) * sum([1,3]) = 1 * 4 = 4
- [1,3,1,2] ä¸­ [3,1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([3,1]) * sum([3,1]) = 1 * 4 = 4
- [1,3,1,2] ä¸­ [1,2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,2]) * sum([1,2]) = 1 * 3 = 3
- [1,3,1,2] ä¸­ [1,3,1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,3,1]) * sum([1,3,1]) = 1 * 5 = 5
- [1,3,1,2] ä¸­ [3,1,2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([3,1,2]) * sum([3,1,2]) = 1 * 6 = 6
- [1,3,1,2] ä¸­ [1,3,1,2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,3,1,2]) * sum([1,3,1,2]) = 1 * 7 = 7
æ‰€æœ‰åŠ›é‡å€¼ä¹‹å’Œä¸º 1 + 9 + 1 + 4 + 4 + 4 + 3 + 5 + 6 + 7 = 44 ã€‚
 

 ç¤ºä¾‹ 2ï¼š 

 è¾“å…¥ï¼šstrength = [5,4,6]
è¾“å‡ºï¼š213
è§£é‡Šï¼šä»¥ä¸‹æ˜¯æ‰€æœ‰è¿ç»­å·«å¸ˆç»„ï¼š
- [5,4,6] ä¸­ [5] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([5]) * sum([5]) = 5 * 5 = 25
- [5,4,6] ä¸­ [4] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([4]) * sum([4]) = 4 * 4 = 16
- [5,4,6] ä¸­ [6] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([6]) * sum([6]) = 6 * 6 = 36
- [5,4,6] ä¸­ [5,4] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([5,4]) * sum([5,4]) = 4 * 9 = 36
- [5,4,6] ä¸­ [4,6] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([4,6]) * sum([4,6]) = 4 * 10 = 40
- [5,4,6] ä¸­ [5,4,6] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([5,4,6]) * sum([5,4,6]) = 4 * 15 = 60
æ‰€æœ‰åŠ›é‡å€¼ä¹‹å’Œä¸º 25 + 16 + 36 + 36 + 40 + 60 = 213 ã€‚
 

 

 æç¤ºï¼š 

 
 1 <= strength.length <= 10âµ 
 1 <= strength[i] <= 10â¹ 
 

 Related Topics æ ˆ æ•°ç»„ å‰ç¼€å’Œ å•è°ƒæ ˆ ğŸ‘ 79 ğŸ‘ 0

"""

from typing import *
from PythonLeetcodeRunner import *

# @lc code=start
# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def totalStrength(self, strength: List[int]) -> int:
        """
        å•è°ƒæ ˆæšä¸¾æ¯ä¸ªæœ€å€¼nums[i]çš„å·¦å³è¾¹ç•ŒL,R,  s.t. min(s[left:right+1]) = nums[i]
            å…¶ä¸­: leftå±äº(L, i], rightå±äº[i, R)

        å¯¹äºæ¯ä¸ªæœ€å€¼ä¸ºnums[i]çš„å­åŒºé—´:  ans_i = sum{ nums[i] * sum(s[left:right+1]) },
            å…¶ä¸­, leftå±äº(L, i], rightå±äº[i, R)


        å®šä¹‰å‰ç¼€å’Œ: p[y]-p[x] = sum(s[x:y+1]), len(p) = len(s)+1
        å®šä¹‰å‰ç¼€å’Œçš„å‰ç¼€å’Œ: pp[y]-pp[x] = sum(p[x:y+1]), len(pp) = len(p)+1

        åŒ–ç®€(note: leftå±äº(L, i], rightå±äº[i, R)):
            ans_i   = sum{ nums[i] * sum(s[left:right+1]) }
                    = nums[i] * sum{ p(right+1) - p(left) }
                    = nums[i] * ( (i-L)*(pp[R+1]-pp[i+1]) - (R-i)*(pp[i+1]-pp[L+1]) )
        """
        mod = int(1e9 + 7)
        n = len(strength)
        nums = strength

        # å‰ç¼€å’Œ
        p = [0]
        for num in strength:
            p.append(p[-1] + num)

        # å‰ç¼€å’Œçš„å‰ç¼€å’Œ
        pp = [0]
        for num in p:
            pp.append(pp[-1] + num)

        ans = 0

        # å•è°ƒæ ˆæšä¸¾æœ€å€¼nums[i]çš„è¾¹ç•Œ
        st = []
        L = [-1] * n
        R = [n] * n
        for i in range(n):
            while st and nums[i] <= nums[st[-1]]:
                R[st[-1]] = i
                st.pop()
            L[i] = st[-1] if st else -1
            st.append(i)

        # ç´¯è®¡æ‰€æœ‰å­åŒºé—´
        for i in range(n):
            # ans += (i - L[i]) * (R[i] - i)
            # print(L[i], i, R[i])

            groupSum = (pp[R[i] + 1] - pp[i + 1]) * (i - L[i]) - \
                       (pp[i + 1] - pp[L[i] + 1]) * (R[i] - i)
            ans += (nums[i] * groupSum) % mod

        return ans % mod


# leetcode submit region end(Prohibit modification and deletion)
# @lc code=end

if __name__ == "__main__":
    TestObj = StartTest(question_content, Solution)
    TestObj.run_test()
